<div class="dialog-container">
  <h2 mat-dialog-title>Détails de l'utilisateur</h2>
  <mat-dialog-content>
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner></mat-spinner>
    </div>

    <div *ngIf="!isLoading && userDetails">
      <mat-tab-group>
        <mat-tab label="Informations">
          <div class="tab-content">
            <mat-card>
              <mat-card-content>
                <div class="info-row">
                  <strong>ID:</strong> {{ userDetails.id }}
                </div>
                <div class="info-row">
                  <strong>Nom d'utilisateur:</strong> {{ userDetails.username }}
                </div>
                <div class="info-row">
                  <strong>Email:</strong> {{ userDetails.email }}
                </div>
                <div class="info-row">
                  <strong>Date d'inscription:</strong> {{ formatDate(userDetails.createdAt) }}
                </div>
                <div class="info-row">
                  <strong>Statut:</strong>
                  <mat-chip [color]="userDetails.enabled ? 'primary' : 'warn'">
                    {{ userDetails.enabled ? 'Actif' : 'Inactif' }}
                  </mat-chip>
                </div>
                <div class="info-row" *ngIf="userDetails.totalPoints">
                  <strong>Points de gamification:</strong> {{ userDetails.totalPoints }}
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>

        <mat-tab label="Budgets">
          <div class="tab-content">
            <table mat-table [dataSource]="userDetails.budgets || []" *ngIf="userDetails.budgets && userDetails.budgets.length > 0">
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Nom</th>
                <td mat-cell *matCellDef="let budget">{{ budget.name }}</td>
              </ng-container>
              <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef>Catégorie</th>
                <td mat-cell *matCellDef="let budget">{{ budget.category }}</td>
              </ng-container>
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Montant</th>
                <td mat-cell *matCellDef="let budget">{{ formatCurrency(budget.amount) }}</td>
              </ng-container>
              <ng-container matColumnDef="spent">
                <th mat-header-cell *matHeaderCellDef>Dépensé</th>
                <td mat-cell *matCellDef="let budget">{{ formatCurrency(budget.spent) }}</td>
              </ng-container>
              <ng-container matColumnDef="period">
                <th mat-header-cell *matHeaderCellDef>Période</th>
                <td mat-cell *matCellDef="let budget">{{ budget.period }}</td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="budgetsColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: budgetsColumns"></tr>
            </table>
            <p *ngIf="!userDetails.budgets || userDetails.budgets.length === 0">Aucun budget</p>
          </div>
        </mat-tab>

        <mat-tab label="Dépenses">
          <div class="tab-content">
            <table mat-table [dataSource]="userDetails.expenses || []" *ngIf="userDetails.expenses && userDetails.expenses.length > 0">
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Description</th>
                <td mat-cell *matCellDef="let expense">{{ expense.description }}</td>
              </ng-container>
              <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef>Catégorie</th>
                <td mat-cell *matCellDef="let expense">{{ expense.category }}</td>
              </ng-container>
              <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Montant</th>
                <td mat-cell *matCellDef="let expense">{{ formatCurrency(expense.amount) }}</td>
              </ng-container>
              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let expense">{{ formatDate(expense.date) }}</td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="expensesColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: expensesColumns"></tr>
            </table>
            <p *ngIf="!userDetails.expenses || userDetails.expenses.length === 0">Aucune dépense</p>
          </div>
        </mat-tab>

        <mat-tab label="Progression">
          <div class="tab-content">
            <table mat-table [dataSource]="userDetails.progress || []" *ngIf="userDetails.progress && userDetails.progress.length > 0">
              <ng-container matColumnDef="course">
                <th mat-header-cell *matHeaderCellDef>Cours</th>
                <td mat-cell *matCellDef="let progress">{{ progress.course?.title }}</td>
              </ng-container>
              <ng-container matColumnDef="completed">
                <th mat-header-cell *matHeaderCellDef>Complété</th>
                <td mat-cell *matCellDef="let progress">
                  <mat-chip [color]="progress.completed ? 'primary' : 'warn'">
                    {{ progress.completed ? 'Oui' : 'Non' }}
                  </mat-chip>
                </td>
              </ng-container>
              <ng-container matColumnDef="score">
                <th mat-header-cell *matHeaderCellDef>Score</th>
                <td mat-cell *matCellDef="let progress">{{ progress.score || 'N/A' }}</td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="progressColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: progressColumns"></tr>
            </table>
            <p *ngIf="!userDetails.progress || userDetails.progress.length === 0">Aucune progression</p>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions>
    <button mat-button (click)="close()">Fermer</button>
  </mat-dialog-actions>
</div>

